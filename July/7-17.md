# TIL Template

## 날짜: 2024-07-17

## Daily Scrum
- 프로젝트 정리 ( 포트폴리오 )
- mk 2차 QA 피드백
- 9주차 과제
- spring 김영한
- 코테 문제

## Today I Learned

## APACHE
- ncsa, httpd 의 버그를 수정하고 기능을 추가하여만든 웹서버
- 클라이언트 요청이 들어오면 프로세스를 만들어 커넥션을 만든다.
- 프로세스를 만드는 시간이 오래걸려 미리 요청이 들어오기 전에 프로세스를 만들어 놓는 prefork 방식을 사용한다.
- 이러한 개발구조는 확장성과 다양한 모듈을 만들어 서버에 빠르게 기능도 추가하기 좋고 요청을 받고 응답을 처리하는 과정을 하나의 서버에서 처리하기 좋았다.

### 단점

- 인터넷 트래픽이 점점 늘어나면서 요청이 많아지다 보니 더이상 서버에 커넥션을 형성하지 못하는 문제가 발생 C10K(Connection 10000개)
    - 동시에 연결된 커넥션 수
        - 요청을 처리하기 우해 서버가 한 시점에 얼마나 많은 클라이언트와 커넥션을 형성하는지
        - 하나의 클라이언트는 하나의 커넥션을 이용해서 여러 요청을 보내기 가능
        - 하나의 커넥션이 긴 시간동안 유지될 수 있다.
    - 초당 요청 처리 수
        - 서버가 얼마나 빨리 요청을 처리할 수 있는지를 나타내는 지표
- 하드웨어적인 문제는 없었지만, 아파치 서버 구조 자체의 문제로 아파치 서버에서 커넥션을 처리하기 위해 프로세스가 할당되는데 이는 메모리 부족으로 이어지고, 프로세스가 늘어남에 따라 리소스 양이 증가했다.
또한 많은 커넥션이 들어오면 CPU코어는 계속해서 프로세스를 바꿔가면서 일을해야해서 컨텍스트 스위칭이 증가하고 cpu 부하가 심해졌다.
- 결론적으로 많은 수의 동시 커넥션을 감당하기에는 아파치서버 구조가 부적합하다. 이러한 구조적인 문제를 개선하기 위해서 Nginx가 두각을 드러냈다.

# Nginx

- **Nginx :** 높은 성능과 안정성을 가지고 가장 많이 사용되고 있는 웹서버
- 아파치와 같은 웹 서버와 비교하면 더 빠르고 대규모 애플리케이션 처리에 적합
- Reverse Proxy Server로 활용하여 WAS 서버의 부하를 줄일 수 있는 로드밸런서로도 활용

## Nginx 의 흐름

- 정적 파일에 대한 요청을 바로 스스로 처리하고 동적 파일에 대한 요청을 받았을 때만 뒤에 서버와 커넥션을 만든다.
- Master Process가 존재하여 Master Process에서 설정파일을 읽고 그 설정에 맞게 worker process를 생성.
- 워커 프로세스가 실질적인 일을하는 프로세스이고 만들어질 때 각자 지정된 listen 소켓을 배정받고 소켓을 통해 새로운 클라이언트 요청이 들어오면 커넥션을 생성하고 요청을 처리.
- Nginx에서는 커넥션 형성, 제거 그리고 새로운 요청의 처리를 이벤트라고 부른다.
- 이벤트들은 OS 커널이 큐 형식으로 워커 프로세스에게 전달해준다.
- 각각의 이벤트는 큐에 담긴 상태로 워커 프로세스가 처리할 때까지 비동기 방식으로 대기한다.


## Nginx의 구조

- **Event - Driven 구조** 하나의 Master Process와 다수의 Worker Process로 구성되어 실행된다. Master Process는 설정 파일(worker process의 개수 등)을 읽고, 유효성을 검사 및 Worker Process를 관리하며 비동기 방식으로 요청들을 Concurrency하게 처리.
- 모든 요청은 Worker Process에서 처리하며 Worker Process 사이에 요청을 효율적으로 분배하기 위해 OS에 의존적이다.
- 새로운 요청이 들어오더라도 새로운 프로세스와 스레드를 생성하지 않기 때문에 적은 자원으로도 효율적으로 운용이 가능하다.
- Worker Process는 보통 cpu의 코어 수 만큼 생성되는데, 코어가 담당하는 프로세스를 대폭 줄 수 잇어. CPU의 컨텍스트 스위칭을 대폭 줄여 부하를 줄일 수 있다. (아파치와 가장 큰 차이점)

## Nginx의 부가기능

- 웹서버, 로드밸런서는 기본
- 웹서버 가속기로 이용가능
- SSL 터미네이션 ( 클라이언트와는 https, 웹서버와는 http 통신하여 부하를 줄일 수 있다)
- HTTP프로토콜을 사용하여 전달하는 컨텐츠를 캐싱할 수 있다.
- HSTS
- CORS 처리
- TCP/UDP 커넥션 부하분산
- HTTP/2 지원

### Reference
- https://www.youtube.com/watch?v=6FAwAXXj5N0
- [https://velog.io/@wijihoon123/Nginx란-무엇인가](https://velog.io/@wijihoon123/Nginx%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)
- [https://nginx.org/en/](https://blog.nginx.org/)

## 🎱오늘의 회고
- 오늘은 비가 많이와서 정말 피곤하고 축축 처지는 날이였다. 우테코 유튜브에 나오는 기술설명이 은근재밌고 흥미로워서 보면서 cs를 다져도 좋을 것 같다. 

> [!NOTE]


