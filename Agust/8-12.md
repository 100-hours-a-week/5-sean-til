# TIL Template

## ë‚ ì§œ: 2024-07-17

## Daily Scrum
- í•­ê³µê¶Œ API
- ë³´ì´ë“œ ìƒë‹´ fix
- db ë°°í¬

## Today Issue
### Amadeus flight api ì‘ë‹µ ì˜¤ë¥˜
1. ë¡œê·¸ì°ì–´ë³´ë‹ˆ ì‘ë‹µì€ ì˜¤ëŠ”ë° return ê°’ìœ¼ë¡œ ì „ë‹¬ì´ ì•ˆëŒ.

flightController
```java
package com.example.travelday.flight.controller;

import com.amadeus.exceptions.ResponseException;
import com.amadeus.resources.FlightOfferSearch;
import com.amadeus.resources.FlightPrice;
import com.amadeus.resources.Location;
import com.example.travelday.flight.service.AmadeusConnect;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Arrays;

@Slf4j
@RestController
@RequestMapping("/api")
public class FlightController {

    private final AmadeusConnect amadeusConnect;

    @Autowired
    public FlightController(AmadeusConnect amadeusConnect) {
        this.amadeusConnect = amadeusConnect;
    }

    @GetMapping("/")
    public String hello(){
        return "HELLO";
    }

    @GetMapping("/locations")
    public Location[] locations(@RequestParam(required=true) String keyword) throws ResponseException {
        return amadeusConnect.location(keyword);
    }

    @GetMapping("/flights")
    public ResponseEntity<String> flights(@RequestParam(required=true) String origin,
                                  @RequestParam(required=true) String destination,
                                  @RequestParam(required=true) String departDate,
                                  @RequestParam(required=true) String adults,
                                  @RequestParam(required = false) String returnDate)
        throws ResponseException {
        log.info("========= ì—¬ê¸°ëŠ” ë˜ë‹? =======");
        FlightOfferSearch[] result = amadeusConnect.flights(origin, destination, departDate, adults, returnDate);
        log.info(Arrays.toString(result));
        return ResponseEntity.ok().body("OK!");
    }

    @PostMapping("/confirm")
    public FlightPrice confirm(@RequestBody(required=true) FlightOfferSearch search) throws ResponseException {
        return amadeusConnect.confirm(search);
    }

}
```

AmadeusConnect
```
package com.example.travelday.flight.service;

import com.amadeus.Amadeus;
import com.amadeus.Params;
import com.amadeus.exceptions.ResponseException;
import com.amadeus.referencedata.Locations;
import com.amadeus.resources.FlightOfferSearch;
import com.amadeus.resources.FlightPrice;
import com.amadeus.resources.Location;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class AmadeusConnect {

    private final Amadeus amadeus;

    public AmadeusConnect(
        @Value("${amadeus.api-key}") String apiKey,
        @Value("${amadeus.api-secret}") String apiSecret) {

        this.amadeus = Amadeus
                           .builder(apiKey, apiSecret)
                           .build();
    }

    public Location[] location(String keyword) throws ResponseException {
        return amadeus.referenceData.locations.get(Params
                                                       .with("keyword", keyword)
                                                       .and("subType", Locations.AIRPORT));
    }

    public FlightOfferSearch[] flights(String origin, String destination, String departDate, String adults, String returnDate) throws ResponseException {
        return amadeus.shopping.flightOffersSearch.get(
            Params.with("originLocationCode", origin)
                .and("destinationLocationCode", destination)
                .and("departureDate", departDate)
                .and("returnDate", returnDate)
                .and("adults", adults)
                .and("max", 3));
    }

    public FlightPrice confirm(FlightOfferSearch offer) throws ResponseException {
        return amadeus.shopping.flightOffersSearch.pricing.post(offer);
    }
}
```

## Today I Learned
### Spring
#### Singleton pattern
"í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´"
- ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•´ì„œ ì‚¬ìš©í•œë‹¤.

- Springì€ spring container ê°€ ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ³ì´ ì ìš©í•˜ì§€ ì•Šì•„ë„ ê°ì²´ ì¸ìŠ¤í„´ìŠ¬ë¥´ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
- ê¸°ì¡´ ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë‹¨ì ì´ì—ˆë˜, ì½”ë“œê°€ ê¸¸ì–´ì§€ê³ , ì˜ì¡´ê´€ê³„ ë¬¸ì œ, í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€, ìœ ì—°ì„± ë–¨ì–´ì§, ocp ìœ„ë°˜ ë“± ëª¨ë“  ë¬¸ì œê°€ í•´ê²°ëœë‹¤.

#### Singleton ë°©ì‹ì˜ ì£¼ì˜ì 
- ì‹±ê¸€í†¤ íŒ¨í„´ì€ ë¬´ìƒíƒœë¡œ ì„¤ê³„í•´ì•¼í•œë‹¤(ì¤‘ìš”)
- ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì—, ë©€í‹°ìŠ¤ë ˆë“œë¥¼ ì ìš©í•˜ê±°ë‚˜ ë¡œì§ì´ ë³µì¡í•´ì§ˆ ë•Œ ê³µìœ  í•„ë“œì— ë¬¸ì œê°€ ìƒê¸°ë©´ ì •ë§ í° ë¬¸ì œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¬´ìƒíƒœë¡œ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

- @Configuration -> ê·¸ëƒ¥ ìŠ¤í”„ë§ ì„¤ì •ì—ëŠ” ì´ê±° ë¶™ì—¬ë¼ ë—

### @Slf4j
#### ì˜ˆì œ
``` java
package com.example.demo;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@Slf4j
@RestController
public class DemoController {

    @GetMapping("/greet")
    public String greet(@RequestParam String name) {
        log.info("Received request to greet {}", name);
        
        try {
            log.debug("Processing the greet request for {}", name);
            // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
            String greeting = "Hello, " + name + "!";
            log.info("Successfully processed the greet request for {}", name);
            return greeting;
        } catch (Exception e) {
            log.error("Error occurred while processing the greet request for {}", name, e);
            throw e;
        }
    }
}
```
1. log.debug() : ë””ë²„ê·¸ ì •ë³´ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‚´ë¶€ ìƒíƒœë¥¼ ìƒì„¸íˆ ê¸°ë¡
2. log.info() : ì¼ë°˜ì ì¸ ì •ë³´ë¡œ ì´ë²¤íŠ¸ë‚˜ ìƒíƒœ ë³€í™”
3. log.warn() : ê²½ê³  ë©”ì„¸ì§€, ì˜ˆê¸°ì¹˜ ì•Šì€ ìƒí™© ê¸°ë¡
4. log.error() : ì—ëŸ¬ë©”ì„¸ì§€, ì˜ˆì™¸ ë‚˜ ì‹¬ê°í•œ ë¬¸ì œ ê¸°ë¡

ë¡œê·¸ í•„í„°ë§ ë° ì¶œë ¥ ì œì–´:

ë¡œê·¸ ë ˆë²¨ ì„¤ì •: ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì–´ë–¤ ë¡œê·¸ë¥¼ ì¶œë ¥í• ì§€ ê²°ì •í•  ë•Œ, ë¡œê·¸ ë ˆë²¨ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¡œê·¸ ë ˆë²¨ì´ INFOë¡œ ì„¤ì •ëœ ê²½ìš°, DEBUG ë ˆë²¨ì˜ ë¡œê·¸ëŠ” ì¶œë ¥ë˜ì§€ ì•Šê³  INFO ì´ìƒ(INFO, WARN, ERROR) ë ˆë²¨ì˜ ë¡œê·¸ë§Œ ì¶œë ¥ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¡œê·¸ì˜ ì–‘ì„ ì œì–´í•˜ê³ , ì¤‘ìš”í•œ ì •ë³´ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤.
ì˜ˆì‹œ: ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë³´í†µ INFOë‚˜ WARN ì´ìƒìœ¼ë¡œ ë¡œê·¸ ë ˆë²¨ì„ ì„¤ì •í•˜ì—¬ ì‹œìŠ¤í…œì— í° ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œë§Œ ë¡œê·¸ê°€ ì¶œë ¥ë˜ë„ë¡ í•˜ê³ , ê°œë°œ í™˜ê²½ì—ì„œëŠ” DEBUGë¥¼ í™œì„±í™”í•´ ë””ë²„ê¹…ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ê¸°ë¡í•  ìˆ˜ ìˆë‹¤.


### responseEntity<string> 
ì •ì˜ : ResponseEntityëŠ” org.springframework.http.ResponseEntity í´ë˜ìŠ¤ì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©°, HTTP ì‘ë‹µì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ëŠ” HTTP ì‘ë‹µì˜ ìƒíƒœ ì½”ë“œ(status code), ì‘ë‹µ í—¤ë”(headers), ì‘ë‹µ ë³¸ë¬¸(body)ì„ í¬í•¨í•  ìˆ˜ ìˆìŒ

ê¸°ëŠ¥
- HTTP ìƒíƒœ ì½”ë“œ ì„¤ì •: ì‘ë‹µì˜ ìƒíƒœ ì½”ë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì„±ê³µì ì¸ ìš”ì²­ì— ëŒ€í•´ 200 OK ìƒíƒœ ì½”ë“œë¥¼ ì„¤ì •í•˜ê±°ë‚˜, ì˜ëª»ëœ ìš”ì²­ì— ëŒ€í•´ 400 Bad Requestë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

- ì‘ë‹µ í—¤ë” ì„¤ì •: HTTP ì‘ë‹µ í—¤ë”ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Content-Type í—¤ë”ë¥¼ ì„¤ì •í•˜ê±°ë‚˜, CORS ê´€ë ¨ í—¤ë”ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

- ì‘ë‹µ ë³¸ë¬¸ ì„¤ì •: ì‘ë‹µì˜ ë‚´ìš©ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ResponseEntity<String>ì´ë¼ë©´ ë³¸ë¬¸ì€ String íƒ€ì…ì´ ë˜ë©°, JSON, XML ë“±ì˜ í˜•íƒœë¡œë„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

ì˜ˆì‹œ
```
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class MyController {

    @GetMapping("/greet")
    public ResponseEntity<String> greet(@RequestParam String name) {
        if (name == null || name.isEmpty()) {
            // ì´ë¦„ì´ ì—†ìœ¼ë©´ 400 Bad Request ì‘ë‹µì„ ë³´ëƒ„
            return new ResponseEntity<>("Name parameter is missing", HttpStatus.BAD_REQUEST);
        }

        // ì„±ê³µì ì¸ ì‘ë‹µì„ ë³´ëƒ„
        String greeting = "Hello, " + name + "!";
        return new ResponseEntity<>(greeting, HttpStatus.OK);
    }
}
```

ResponseEntityì˜ ìƒì„± ë°©ë²•

ë¹Œë” íŒ¨í„´ ì‚¬ìš©: ResponseEntity í´ë˜ìŠ¤ì—ëŠ” ë¹Œë” íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ë” ì§ê´€ì ì´ê³  ì½ê¸° ì‰¬ìš´ ë°©ì‹ìœ¼ë¡œ ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ok(), badRequest(), status() ë“±ì˜ ë©”ì„œë“œê°€ ìˆë‹¤.

``` java
ResponseEntity.ok("Success");
ResponseEntity.status(HttpStatus.NOT_FOUND).body("Resource not found");

// ì˜ˆì‹œ
/ /ì„±ê³µ ì‘ë‹µ (200 OK):

return ResponseEntity.ok("Success");

// ì˜ëª»ëœ ìš”ì²­ ì‘ë‹µ (400 Bad Request):
return ResponseEntity.badRequest().body("Invalid request parameters");

//ì»¤ìŠ¤í…€ ìƒíƒœ ì½”ë“œì™€ í—¤ë” ì„¤ì •:
return ResponseEntity.status(HttpStatus.CREATED)
                     .header("Location", "/resource/12345")
                     .body("Resource created");
```

### Reference
-

## ğŸ±ì˜¤ëŠ˜ì˜ íšŒê³ 
- ì˜¤ëŠ˜ amadeus apiê°€ ìƒê°ëŒ€ë¡œ ì‘ë‹µì´ ì•ˆì™€ì„œ erdê°€ ë§‰í˜”ë‹¤. ì—°ë‹¬ì•„ apiëª…ì„¸ì„œë„ ëª»í–ˆëŠ”ë°, ë‚´ì¼ì€ apiëª…ì„¸ì„œë¶€í„° ì§„í–‰í•  ì˜ˆì •ì´ë‹¤.

> [!NOTE]


        